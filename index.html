<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>We Power On — Men's Walk & Talk Map</title>

<!-- Intro Rust Base (H1 only) -->
  <style>
  @font-face{
    font-family:"Intro Rust Base";
    src:url("https://static.wixstatic.com/ufonts/0737e3_d7be359c419b4134a1683bddb51a5197/woff2/file.woff2") format("woff2");
    font-weight:400; font-style:normal; font-display:swap;
  }

    :root{
      --top-gap: 24px;
      --map-bottom-trim: 12px;
    --accent: rgb(251,187,61);
    --text: #000;
  }

  /* remove inner scroll in Wix embed; mobile restores it */
  html, body { height: 100%; overflow: hidden; }
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
  }

  /* LEFT COLUMN */
  .walk-list-wrapper {
    flex: 0 0 320px;
    padding: var(--top-gap) 20px 0;
    height: calc(100vh - var(--map-bottom-trim));
    display: flex;
    flex-direction: column;
    background: #fff;
    z-index: 2;
  }

  .map-header { margin: 0 0 16px; }
  .map-header h1{
    margin: 0 0 8px;
    font-family: "Intro Rust Base","INTRO RUST BASE","IntroRustBase", sans-serif;
    font-size: 42px;
    line-height: 1.05;
    font-weight: 400;
    letter-spacing: 0.2px;
    color: var(--text);
  }
  .map-header p{
    margin: 0 0 16px;
    font-size: 16px;
    line-height: 1.4;
    color: var(--text);
  }

  .search-box { margin-top: -6px; margin-bottom: 11px; }
  .search-box input {
    width: 92%;
    padding: 6px 10px;
    font-size: 14px;
    border: 2px solid var(--accent);
    background-color: var(--accent);
    color: white;
    border-radius: 8px;
    outline: none;
  }
  .search-box input::placeholder { color: #222; }

  h2.region-heading {
    border-bottom: 1px solid #000;
    padding-bottom: 4px;
    margin: 20px 0 8px;
    font-size: 16px;
    color: #000;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
  }
  h2 .dropdown-icon {
    font-size: 16px;
    color: var(--accent);
    transition: transform 0.3s ease;
  }
  h2.collapsed .dropdown-icon { transform: rotate(-90deg); }
  .collapsed + ul { display: none; }

  .walk-list {
    list-style: none;
    padding: 0;
    margin: 0 0 6px;
    max-height: 120px; /* ~4 items */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    background: white;
    scrollbar-width: thin;
    scrollbar-color: white var(--accent);
  }
  .walk-list::-webkit-scrollbar { width: 8px; }
  .walk-list::-webkit-scrollbar-track { background: var(--accent); border-radius: 0; }
  .walk-list::-webkit-scrollbar-thumb { background: white; border-radius: 0; }

  .walk-list li { margin: 6px 0; }
  .walk-list button {
    all: unset;
    cursor: pointer;
    color: #000;
    font-size: 14px;
    padding: 4px 0;
    border-radius: 6px;
  }
  .walk-list button:hover,
  .walk-list button:focus-visible {
    color: var(--accent);
    background: rgba(251,187,61,.08);
    padding-left: 6px;
    outline: 2px solid rgba(0,0,0,.4);
  }

  /* RIGHT COLUMN (Leaflet map) */
  .map-wrapper {
    position: sticky;
    top: 0;
    height: calc(100vh - var(--map-bottom-trim));
    flex: 1;
    display: flex;
    align-items: stretch;
    margin-left: -10px;
    margin-top: var(--top-gap);
    overflow: hidden;
    background:#b8e0e2; /* sea */
  }
  #map { width: 100%; height: 100%; }

  /* Region labels (placed as Leaflet divIcons) */
  .region-label{
    font-weight: 800;
    font-size: 12px;
    letter-spacing: .4px;
    color:#fff;
    text-transform: uppercase;
    text-shadow: 0 1px 2px rgba(0,0,0,.45), 0 0 2px rgba(0,0,0,.25);
    white-space: nowrap;
    user-select: none;
    pointer-events: none;
  }

  /* Leaflet default styles */
  @import url("https://unpkg.com/leaflet@1.9.4/dist/leaflet.css");

  /* Popup (make it look like your original info-box) */
  .walk-popup.leaflet-popup {
    pointer-events: auto;
  }
  .walk-popup .leaflet-popup-content-wrapper {
    border-radius: 10px;
    border: 1px solid #ccc;
    box-shadow: 0 8px 24px rgba(0,0,0,.18);
  }
  .walk-popup .leaflet-popup-tip {
    background: #fff;
    box-shadow: 0 8px 24px rgba(0,0,0,.18);
  }
  .walk-popup .leaflet-popup-content {
    margin: 10px;
    text-align: center;
    font-size: 14px;
    color:#000;
  }
  .walk-popup img.walk-logo {
    width: 60px; height: auto; border-radius: 6px; display:block; margin:0 auto 8px;
  }
  .walk-popup .loc-line { display:inline-flex; align-items:center; gap:6px; margin:4px 0 2px; }
  .walk-popup .icon-pin { width:16px;height:16px; fill: var(--accent); }
  .walk-popup .icon-pin .hole { fill: #fff; }
  .walk-popup .links { margin-top: 8px; display:flex; flex-direction:column; gap:6px; align-items:center; }
  .walk-popup .links a { text-decoration:none; color:#000; display:inline-flex; align-items:center; gap:8px; }
  .walk-popup .links a:hover { text-decoration: underline; }

  /* Mobile */
  @media (max-width: 768px) {
    html, body { overflow: auto; height: auto; }
    body { flex-direction: column; }
    .map-wrapper { height: auto; order: 2; margin-left: 0; margin-top: 0; }
    .walk-list-wrapper { order: 1; width: 100%; height: auto; }
  }
  </style>

<!-- Leaflet JS (after CSS import above) -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>

  <!-- LEFT: Title + lists -->
  <div class="walk-list-wrapper">
    <div class="map-header">
      <h1>MEN'S WALK &amp; TALK MAP</h1> <br>
      <p>This map of support shines a light on men's walk and talk groups across the UK.</p>
        <p>Search below to find a walk near you or click on the map to explore.</p>
    </div>

    <div class="search-box">
      <input type="text" id="walkSearch" placeholder="Search walks..." />
      </div>

    <!-- ENGLAND -->
    <h2 class="region-heading" onclick="toggleRegion(this)">England <span class="dropdown-icon">▼</span></h2>
    <ul class="walk-list" id="list-england">
      <li><button data-id="epsom">Surrey – Epsom: We Power On</button></li>
      <li><button data-id="canterbury">Kent – Canterbury: Mindful Steps</button></li>
      <li><button data-id="birmingham">Midlands – Birmingham: Men's Brew Walk</button></li>
      <li><button data-id="london">London – River Walkers</button></li>
      <li><button data-id="manchester">Manchester – Urban Stride</button></li>
      <li><button data-id="liverpool">Liverpool – Dockside Steps</button></li>
        </ul>

    <!-- WALES -->
    <h2 class="region-heading" onclick="toggleRegion(this)">Wales <span class="dropdown-icon">▼</span></h2>
    <ul class="walk-list" id="list-wales">
      <li><button data-id="cardiff">Cardiff – Walk &amp; Talk Cymru</button></li>
      <li><button data-id="swansea">Swansea – Coastal Strides</button></li>
      <li><button data-id="bangor_wales">Bangor – Mountain Trekkers</button></li>
      <li><button data-id="newport_wales">Newport – Friendship Walk</button></li>
      <li><button data-id="wrexham">Wrexham – Green Steps</button></li>
      <li><button data-id="aberystwyth">Aberystwyth – Sea Breeze Walk</button></li>
        </ul>

    <!-- SCOTLAND -->
    <h2 class="region-heading" onclick="toggleRegion(this)">Scotland <span class="dropdown-icon">▼</span></h2>
    <ul class="walk-list" id="list-scotland">
      <li><button data-id="edinburgh">Edinburgh – Highland Strides</button></li>
      <li><button data-id="glasgow">Glasgow – Clyde Walkers</button></li>
      <li><button data-id="aberdeen_scot">Aberdeen – Coastal Trekkers</button></li>
      <li><button data-id="dundee">Dundee – Riverside Steps</button></li>
      <li><button data-id="inverness">Inverness – Lochside Strides</button></li>
      <li><button data-id="stirling">Stirling – Castle Path Walk</button></li>
        </ul>

    <!-- NORTHERN IRELAND -->
    <h2 class="region-heading" onclick="toggleRegion(this)">Northern Ireland <span class="dropdown-icon">▼</span></h2>
    <ul class="walk-list" id="list-ni">
      <li><button data-id="belfast">Belfast – Cavehill: Men's Cavehill Walking Club</button></li>
      <li><button data-id="derry">Derry – Riverfront Walkers</button></li>
      <li><button data-id="lisburn">Lisburn – Step Together</button></li>
      <li><button data-id="newry">Newry – Hill Trekkers</button></li>
      <li><button data-id="armagh">Armagh – Orchard Strides</button></li>
      <li><button data-id="bangor_ni">Bangor – Coastal Breeze Walk</button></li>
        </ul>
  </div>

  <!-- RIGHT: Map -->
  <div class="map-wrapper">
    <div id="map" aria-label="Interactive map with cities and walk locations"></div>
      </div>

  <script>
/* ========= Data / config ========= */
const ICON = 'https://static.wixstatic.com/media/0115fe_e7001c4e539a47aa96028d8e89cf3ee8~mv2.webp';
const SITE_URL = 'https://www.wepoweron.co.uk';
const INSTAGRAM_HANDLE = '@we_power_on';
const INSTAGRAM_URL = 'https://instagram.com/we_power_on';

const ICON_SVG_GLOBE = `
  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false" width="16" height="16">
    <circle cx="12" cy="12" r="9"></circle>
    <path d="M3 12h18M12 3a15 15 0 0 1 0 18M12 3a15 15 0 0 0 0 18"></path>
  </svg>`;
const ICON_SVG_INSTA = `
  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false" width="16" height="16">
    <rect x="3.5" y="3.5" width="17" height="17" rx="4"></rect>
    <circle cx="12" cy="12" r="4.5"></circle>
    <circle cx="17.2" cy="6.8" r="1.2"></circle>
  </svg>`;
const ICON_SVG_PIN = `
  <svg class="icon-pin" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
    <path d="M12 2c4.42 0 8 3.34 8 7.46 0 5.53-6.2 11.61-7.46 12.72a.74.74 0 0 1-1.08 0C10.2 21.07 4 15 4 9.46 4 5.34 7.58 2 12 2z"></path>
    <circle class="hole" cx="12" cy="9" r="3"></circle>
  </svg>`;

    const WALKS = [
      // England
      { id:"epsom",      name:"We Power On",           place:"Epsom, Surrey",     lat:51.334, lng:-0.266, url:SITE_URL },
      { id:"canterbury", name:"Mindful Steps",         place:"Canterbury, Kent",  lat:51.280, lng: 1.080, url:SITE_URL },
      { id:"birmingham", name:"Men's Brew Walk",       place:"Birmingham, West Midlands", lat:52.486, lng:-1.890, url:SITE_URL },
      { id:"london",     name:"River Walkers",         place:"London",            lat:51.507, lng:-0.128, url:SITE_URL },
      { id:"manchester", name:"Urban Stride",          place:"Manchester",        lat:53.480, lng:-2.242, url:SITE_URL },
      { id:"liverpool",  name:"Dockside Steps",        place:"Liverpool",         lat:53.407, lng:-2.991, url:SITE_URL },
      // Wales
      { id:"cardiff",    name:"Walk & Talk Cymru",     place:"Cardiff",           lat:51.481, lng:-3.179, url:SITE_URL },
      { id:"swansea",    name:"Coastal Strides",       place:"Swansea",           lat:51.621, lng:-3.943, url:SITE_URL },
      { id:"bangor_wales", name:"Mountain Trekkers",   place:"Bangor, Gwynedd",   lat:53.230, lng:-4.130, url:SITE_URL },
      { id:"newport_wales", name:"Friendship Walk",    place:"Newport",           lat:51.586, lng:-3.000, url:SITE_URL },
      { id:"wrexham",    name:"Green Steps",           place:"Wrexham",           lat:53.046, lng:-2.993, url:SITE_URL },
      { id:"aberystwyth",name:"Sea Breeze Walk",       place:"Aberystwyth",       lat:52.415, lng:-4.082, url:SITE_URL },
      // Scotland
      { id:"edinburgh",  name:"Highland Strides",      place:"Edinburgh",         lat:55.953, lng:-3.188, url:SITE_URL },
      { id:"glasgow",    name:"Clyde Walkers",         place:"Glasgow",           lat:55.864, lng:-4.251, url:SITE_URL },
      { id:"aberdeen_scot", name:"Coastal Trekkers",   place:"Aberdeen",          lat:57.149, lng:-2.094, url:SITE_URL },
      { id:"dundee",     name:"Riverside Steps",       place:"Dundee",            lat:56.462, lng:-2.970, url:SITE_URL },
      { id:"inverness",  name:"Lochside Strides",      place:"Inverness",         lat:57.477, lng:-4.224, url:SITE_URL },
      { id:"stirling",   name:"Castle Path Walk",      place:"Stirling",          lat:56.116, lng:-3.936, url:SITE_URL },
      // Northern Ireland
      { id:"belfast",    name:"Men's Cavehill Walking Club", place:"Belfast, Cavehill", lat:54.597, lng:-5.930, url:"https://www.facebook.com/p/Mens-Cavehill-Walking-Club-100086241889121/?locale=en_GB" },
      { id:"derry",      name:"Riverfront Walkers",    place:"Derry / Londonderry", lat:54.997, lng:-7.309, url:SITE_URL },
      { id:"lisburn",    name:"Step Together",         place:"Lisburn",            lat:54.514, lng:-6.036, url:SITE_URL },
      { id:"newry",      name:"Hill Trekkers",         place:"Newry",              lat:54.175, lng:-6.339, url:SITE_URL },
      { id:"armagh",     name:"Orchard Strides",       place:"Armagh",             lat:54.350, lng:-6.650, url:SITE_URL },
      { id:"bangor_ni",  name:"Coastal Breeze Walk",   place:"Bangor (NI)",        lat:54.660, lng:-5.670, url:SITE_URL },
    ];

/* ========= Build popup HTML ========= */
function popupHTML(w){
  return `
    <img src="${ICON}" class="walk-logo" alt="">
    <strong>${w.name}</strong>
    <div class='loc-line'>${ICON_SVG_PIN}<span>${w.place}</span></div>
    <div class='links'>
      <a href='${w.url}' target='_blank' rel='noopener' aria-label='Website'>
        ${ICON_SVG_GLOBE}<span>wepoweron.co.uk</span>
      </a>
      <a href='${INSTAGRAM_URL}' target='_blank' rel='noopener' aria-label='Instagram'>
        ${ICON_SVG_INSTA}<span>${INSTAGRAM_HANDLE}</span>
      </a>
    </div>`;
}

/* ========= Leaflet map ========= */
// UK geographic bounds used to anchor the georeferenced overlay
const UK_BOUNDS = L.latLngBounds([[49.84, -8.65],[60.95, 2.10]]);

const map = L.map('map', {
  zoomControl: true,
  scrollWheelZoom: true,
  maxBounds: UK_BOUNDS.pad(0.25),
  maxBoundsViscosity: 0.2
});
map.fitBounds(UK_BOUNDS);

// Nice labelled basemap so cities appear
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; OSM & CARTO',
  subdomains: 'abcd',
  maxZoom: 19
    }).addTo(map);

// Georeferenced overlay of the reference UK regions image so the colours match your design
// This keeps perfect alignment at all zoom levels without any drifting
L.imageOverlay(
  'https://static.wixstatic.com/media/0115fe_de5d106d4b3b46579b02adc51d9131d4~mv2.webp',
  UK_BOUNDS,
  { opacity: 1, interactive: false }
).addTo(map);

// Custom marker icon
const walkIcon = L.icon({
  iconUrl: ICON,
  iconSize: [42, 48],
  iconAnchor: [21, 48],
  popupAnchor: [0, -50]
});

// State
    const markers = new Map();
let currentId = null;
let hideTimeout = null;
let hoverLockUntil = 0;
const HOVER_LOCK_MS = 3000;

// Build markers
    WALKS.forEach(w => {
  const m = L.marker([w.lat, w.lng], { icon: walkIcon, riseOnHover: true })
    .addTo(map);

  m.bindPopup(popupHTML(w), {
    className: 'walk-popup',
    autoClose: false,
    closeOnClick: false,
    closeButton: false,
    offset: L.point(0, -10)
  });

  // Hover shows popup on desktop; click/tap opens popup on all devices
      m.on('mouseover', () => showWalk(w.id));
      m.on('mouseout', () => delayedHide());
  m.on('click', () => showWalk(w.id, { force:true }));

  // Keep popup open while hovering it
      m.on('popupopen', (e) => {
    const el = e.popup.getElement();
    if (!el) return;
        el.addEventListener('mouseenter', cancelHide);
        el.addEventListener('mouseleave', delayedHide);
      });

      markers.set(w.id, m);
    });

/* ========= Popup control ========= */
    function showWalk(id, opts={}){
      if (!opts.force && Date.now() < hoverLockUntil && id !== currentId) return;

      cancelHide();
  const marker = markers.get(id);
  if (!marker) return;

  // Close previous
  if (currentId && currentId !== id){
    const prev = markers.get(currentId);
    prev && prev.closePopup();
  }
  currentId = id;
  marker.openPopup();
}

function hideWalk(){
  if (currentId){
    const m = markers.get(currentId);
    m && m.closePopup();
    currentId = null;
  }
}
function delayedHide(){ cancelHide(); hideTimeout = setTimeout(hideWalk, 8000); }
    function cancelHide(){ if (hideTimeout){ clearTimeout(hideTimeout); hideTimeout=null; } }

// Close by clicking the map background or pressing Escape
map.on('click', (e)=>{
  // Ignore clicks that originate from markers/popups
  const t = e.originalEvent?.target;
  if (t && (t.closest?.('.leaflet-marker-icon') || t.closest?.('.leaflet-popup'))) return;
  hideWalk();
});
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') hideWalk(); }, {passive:true});

/* ========= Sidebar behaviour ========= */
function toggleRegion(h){
  h.classList.toggle('collapsed');
  const list = h.nextElementSibling;
  if (list && list.tagName === 'UL'){
    list.style.display = (list.style.display === 'none') ? 'block' : 'none';
  }
}

document.querySelectorAll('.walk-list button').forEach(btn=>{
      const id = btn.dataset.id;
      const w = WALKS.find(x=>x.id===id);
      btn.addEventListener('mouseenter', ()=> showWalk(id));
      btn.addEventListener('mouseleave', ()=> delayedHide());
      btn.addEventListener('click', ()=>{
    const m = markers.get(id);
    if (!m) return;
        hoverLockUntil = Date.now() + HOVER_LOCK_MS;
        map.flyTo(m.getLatLng(), Math.max(9, map.getZoom()), { duration: 0.7 });
        showWalk(id, { force:true });
      });
    });

/* ========= Search (expand groups with matches) ========= */
const walkSearch = document.getElementById('walkSearch');
const regionHeadings = Array.from(document.querySelectorAll('h2.region-heading'));
const lists = Array.from(document.querySelectorAll('.walk-list'));
let saved = null, scheduled = false, query = '';

walkSearch.addEventListener('input', ()=>{
  query = (walkSearch.value || '').trim().toLowerCase();
  if (scheduled) return;
  scheduled = true;
  requestAnimationFrame(applyFilter);
});

function applyFilter(){
  scheduled = false;
  const searching = query.length > 0;

  if (searching && !saved){
    saved = {
      ulDisplay: lists.map(ul => ul.style.display || ''),
      collapsed: regionHeadings.map(h => h.classList.contains('collapsed')),
    };
  }

  if (!searching){
    lists.forEach(ul => ul.querySelectorAll('li').forEach(li => li.style.display = ''));
    if (saved){
      lists.forEach((ul,i)=> ul.style.display = saved.ulDisplay[i]);
      regionHeadings.forEach((h,i)=> h.classList.toggle('collapsed', saved.collapsed[i]));
      saved = null;
    }
        return;
      }

  lists.forEach((ul, i) => {
    let matches = 0;
    ul.querySelectorAll('li').forEach(li => {
      const ok = (li.textContent || '').toLowerCase().includes(query);
      li.style.display = ok ? '' : 'none';
      if (ok) matches++;
    });

    const heading = regionHeadings[i];
    if (matches > 0) {
      ul.style.display = 'block';
      heading.classList.remove('collapsed');
    } else {
      ul.style.display = 'none';
    }
  });
}

/* ========= Quality-of-life ========= */
map.on('movestart', cancelHide); // don't auto-hide mid-panning
map.on('zoomstart', cancelHide);

/* ========= Region labels (approximate centroids) ========= */
const REGION_LABELS = [
  // Nations
  { name:'SCOTLAND',         lat:56.8,  lng:-4.2 },
  { name:'WALES',            lat:52.4,  lng:-3.7 },
  { name:'NORTHERN IRELAND', lat:54.7,  lng:-6.7 },
  // English regions
  { name:'NORTH EAST',   lat:54.9, lng:-1.6 },
  { name:'NORTH WEST',   lat:53.9, lng:-2.6 },
  { name:'YORKS / HUMBER', lat:53.9, lng:-1.0 },
  { name:'EAST MIDLANDS', lat:52.9, lng:-1.2 },
  { name:'WEST MIDLANDS', lat:52.5, lng:-2.1 },
  { name:'EAST OF ENGLAND', lat:52.1, lng:0.5 },
  { name:'SOUTH EAST',   lat:51.2, lng:-0.9 },
  { name:'SOUTH WEST',   lat:50.9, lng:-3.7 },
  { name:'LONDON',       lat:51.5, lng:-0.1 },
];

REGION_LABELS.forEach(r=>{
  L.marker([r.lat, r.lng], {
    interactive:false,
    icon: L.divIcon({ className:'region-label', html:r.name })
  }).addTo(map);
});
  </script>
</body>
</html>
