<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>We Power On — Walk & Talk Map (Dynamic Overlay)</title>

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    :root{
      --accent: #FBBB3D;
      --text: #0A0A0A;
      --muted:#666;
      --bg: #E2F3F7;       /* close to your ocean background */
      --panel:#FFF;
      --ring: 3px solid rgba(0,0,0,.6);
    }
    *{ box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color: var(--text);
      background: var(--panel);
    }

    /* Layout: sticky map on the right, content on the left */
    .page{
      display:grid;
      grid-template-columns: 340px 1fr;
      min-height: 100dvh;
    }
    .sidebar{
      padding: 24px 18px 16px;
      max-height: 100dvh;
      overflow:auto;
    }
    .map-stick{
      position: sticky;
      top: 0;
      height: 100dvh;
      background: var(--bg);
      border-left: 1px solid #ddd;
    }
    #map{
      height: 100%;
      width: 100%;
    }

    /* Header + search */
    h1{
      margin: 0 0 10px;
      font-size: clamp(26px, 4vw, 40px);
      line-height: 1.05;
      font-weight: 800;
    }
    .lead{ margin:0 0 8px; color:#111; }
    .search{ position: sticky; top: 8px; padding: 8px 0 10px; background: var(--panel); z-index: 2; }
    .search input{
      width: 100%;
      border: 2px solid var(--accent);
      background: var(--accent);
      color: #000;
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 15px;
      outline: none;
    }
    .search input:focus{ outline: 3px solid rgba(251,187,61,.7); }
    .search input::placeholder{ color:#1d1d1d; }

    /* Region sections */
    .region{ margin: 14px 0; }
    .region-toggle{
      width:100%;
      background:transparent;
      border:0;
      border-bottom:1px solid #000;
      padding:10px 2px 8px;
      font-size:16px;
      font-weight:700;
      display:flex; align-items:center; justify-content:space-between;
      cursor:pointer;
    }
    .region-toggle:focus-visible{ outline: var(--ring); border-radius: 6px; }
    .region-icon{ color: var(--accent); transition: transform .2s ease; }
    .region-toggle[aria-expanded="false"] .region-icon{ transform: rotate(-90deg); }

    .walk-list{
      list-style:none; padding:0; margin:8px 0 0;
      max-height: 140px; overflow:auto;
      scrollbar-width: thin; scrollbar-color: var(--accent) #fff;
    }
    .walk-list::-webkit-scrollbar{ width:8px; }
    .walk-list::-webkit-scrollbar-thumb{ background: var(--accent); }

    .walk-item{ margin: 6px 0; }
    .walk-btn{
      width:100%; text-align:left; background:transparent; border:0;
      padding:6px 0; font-size:14px; cursor:pointer; border-radius:6px;
    }
    .walk-btn:hover, .walk-btn:focus-visible{
      color: var(--accent); outline: var(--ring);
      background: rgba(251,187,61,.08); padding-left: 6px;
    }

    /* Leaflet tweaks */
    .leaflet-container{
      background: var(--bg);  /* no gray checkerboard when overlay is loading */
      outline: none;
    }
    .leaflet-control-attribution{ display:none; } /* minimalist look */

    /* Popups: make them match your card style */
    .leaflet-popup-content-wrapper{
      border-radius: 10px;
      border: 1px solid #ccc;
      box-shadow: 0 8px 24px rgba(0,0,0,.18);
    }
    .leaflet-popup-content{
      margin: 10px 12px;
      font-size: 14px;
      color: #000;
    }
    .leaflet-popup-tip{ display:none; } /* cleaner */
    .popup-header{
      display: grid; grid-template-columns: 48px 1fr; gap: 10px; align-items: center;
      margin-bottom: 6px;
    }
    .popup-logo{
      width:48px; height:48px; border-radius:6px; object-fit:cover; display:block;
    }
    .popup-title{ font-weight: 800; line-height: 1.2; }
    .popup-loc{ color:#111; display:flex; gap:6px; align-items:center; margin-top: 4px; }
    .links{ display:flex; flex-direction:column; gap:6px; margin-top:8px; }
    .links a{ color:#000; text-decoration:none; display:inline-flex; gap:8px; align-items:center; }
    .links a:hover{ text-decoration: underline; }

    @media (max-width: 768px){
      .page{ display:block; }
      .sidebar{ max-height:none; padding: 16px; }
      .map-stick{ position: static; height: 65dvh; border-left: 0; }
      #map{ height: 100%; }
    }
    .visually-hidden{ position:absolute!important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }
  </style>
</head>
<body>
  <main class="page">
    <!-- LEFT: content -->
    <aside class="sidebar" aria-label="Walk directories and search">
      <h1>MEN'S WALK &amp; TALK MAP</h1>
      <p class="lead">This map of support shines a light on men's walk &amp; talk groups across the UK.</p>
      <p class="lead">Search below to find a walk near you or click on the map to explore.</p>

      <div class="search">
        <label class="visually-hidden" for="walkSearch">Search walks</label>
        <input id="walkSearch" type="search" placeholder="Search walks…" />
      </div>

      <!-- England -->
      <section class="region" aria-labelledby="heading-england">
        <button class="region-toggle" id="heading-england" aria-expanded="true" aria-controls="list-england">
          England <span class="region-icon" aria-hidden="true">▼</span>
        </button>
        <ul class="walk-list" id="list-england">
          <li class="walk-item"><button class="walk-btn" data-id="epsom">Surrey – Epsom: We Power On</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="canterbury">Kent – Canterbury: Mindful Steps</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="birmingham">Midlands – Birmingham: Men's Brew Walk</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="london">London – River Walkers</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="manchester">Manchester – Urban Stride</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="liverpool">Liverpool – Dockside Steps</button></li>
        </ul>
      </section>

      <!-- Wales -->
      <section class="region" aria-labelledby="heading-wales">
        <button class="region-toggle" id="heading-wales" aria-expanded="true" aria-controls="list-wales">
          Wales <span class="region-icon" aria-hidden="true">▼</span>
        </button>
        <ul class="walk-list" id="list-wales">
          <li class="walk-item"><button class="walk-btn" data-id="cardiff">Cardiff – Walk &amp; Talk Cymru</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="swansea">Swansea – Coastal Strides</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="bangor_wales">Bangor – Mountain Trekkers</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="newport_wales">Newport – Friendship Walk</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="wrexham">Wrexham – Green Steps</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="aberystwyth">Aberystwyth – Sea Breeze Walk</button></li>
        </ul>
      </section>

      <!-- Scotland -->
      <section class="region" aria-labelledby="heading-scotland">
        <button class="region-toggle" id="heading-scotland" aria-expanded="true" aria-controls="list-scotland">
          Scotland <span class="region-icon" aria-hidden="true">▼</span>
        </button>
        <ul class="walk-list" id="list-scotland">
          <li class="walk-item"><button class="walk-btn" data-id="edinburgh">Edinburgh – Highland Strides</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="glasgow">Glasgow – Clyde Walkers</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="aberdeen_scot">Aberdeen – Coastal Trekkers</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="dundee">Dundee – Riverside Steps</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="inverness">Inverness – Lochside Strides</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="stirling">Stirling – Castle Path Walk</button></li>
        </ul>
      </section>

      <!-- Northern Ireland -->
      <section class="region" aria-labelledby="heading-ni">
        <button class="region-toggle" id="heading-ni" aria-expanded="true" aria-controls="list-ni">
          Northern Ireland <span class="region-icon" aria-hidden="true">▼</span>
        </button>
        <ul class="walk-list" id="list-ni">
          <li class="walk-item"><button class="walk-btn" data-id="belfast">Belfast – Cavehill: Men's Cavehill Walking Club</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="derry">Derry – Riverfront Walkers</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="lisburn">Lisburn – Step Together</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="newry">Newry – Hill Trekkers</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="armagh">Armagh – Orchard Strides</button></li>
          <li class="walk-item"><button class="walk-btn" data-id="bangor_ni">Bangor – Coastal Breeze Walk</button></li>
        </ul>
      </section>
    </aside>

    <!-- RIGHT: dynamic map -->
    <section class="map-stick" aria-label="Interactive map">
      <div id="map" role="application" aria-label="UK Map with walk locations"></div>
    </section>
  </main>

  <script>
    /* -------------------------------
       1) Map setup with image overlay
    --------------------------------*/
    // UK bounds (approx): [southWest, northEast]
    const UK_BOUNDS = L.latLngBounds([49.5, -11.0], [60.9, 2.1]);

    const map = L.map('map', {
      zoomControl: true,
      attributionControl: false,
      minZoom: 5,
      maxZoom: 12,
      zoomSnap: 0.1,
      zoomDelta: 0.5,
      maxBounds: UK_BOUNDS.pad(0.1),
      maxBoundsViscosity: 1.0,
    });

    // Fit initial view
    map.fitBounds(UK_BOUNDS);

    // Your artwork as a georeferenced overlay (looks exactly like the static image)
    const MAP_IMAGE_URL = "https://static.wixstatic.com/media/0115fe_de5d106d4b3b46579b02adc51d9131d4~mv2.webp";
    L.imageOverlay(MAP_IMAGE_URL, UK_BOUNDS, { opacity: 1, interactive: false }).addTo(map);

    // Optional: smooth wheel zoom feel
    map.scrollWheelZoom.enable();

    /* -------------------------------
       2) Marker data (real lat/lngs)
    --------------------------------*/
    const ICON_URL = "https://static.wixstatic.com/media/0115fe_e7001c4e539a47aa96028d8e89cf3ee8~mv2.webp";
    const icon = L.icon({
      iconUrl: ICON_URL,
      iconSize: [38, 48],      // tweak to taste
      iconAnchor: [19, 48],    // bottom center
      popupAnchor: [0, -44]
    });

    // Helper to build popup HTML (matches your design)
    const SITE_URL = "https://www.wepoweron.co.uk";
    const INSTAGRAM_URL = "https://instagram.com/we_power_on";

    const makePopup = (name, place) => `
      <div class="popup-header">
        <img class="popup-logo" src="${ICON_URL}" alt="">
        <div>
          <div class="popup-title">${name}</div>
          <div class="popup-loc">📍 ${place}</div>
        </div>
      </div>
      <div class="links">
        <a href="${SITE_URL}" target="_blank" rel="noopener">🌐 wepoweron.co.uk</a>
        <a href="${INSTAGRAM_URL}" target="_blank" rel="noopener">📸 @we_power_on</a>
      </div>
    `;

    // All locations (approx lat/lng)
    const LOCATIONS = {
      // England
      epsom:        { lat:51.334, lng:-0.266, name:"We Power On", place:"Epsom, Surrey", url:SITE_URL },
      canterbury:   { lat:51.280, lng: 1.080, name:"Mindful Steps", place:"Canterbury, Kent", url:SITE_URL },
      birmingham:   { lat:52.486, lng:-1.890, name:"Men's Brew Walk", place:"Birmingham, West Midlands", url:SITE_URL },
      london:       { lat:51.507, lng:-0.128, name:"River Walkers", place:"London", url:SITE_URL },
      manchester:   { lat:53.480, lng:-2.242, name:"Urban Stride", place:"Manchester", url:SITE_URL },
      liverpool:    { lat:53.407, lng:-2.991, name:"Dockside Steps", place:"Liverpool", url:SITE_URL },

      // Wales
      cardiff:      { lat:51.481, lng:-3.179, name:"Walk & Talk Cymru", place:"Cardiff", url:SITE_URL },
      swansea:      { lat:51.621, lng:-3.943, name:"Coastal Strides", place:"Swansea", url:SITE_URL },
      bangor_wales: { lat:53.230, lng:-4.130, name:"Mountain Trekkers", place:"Bangor, Gwynedd", url:SITE_URL },
      newport_wales:{ lat:51.586, lng:-3.000, name:"Friendship Walk", place:"Newport", url:SITE_URL },
      wrexham:      { lat:53.046, lng:-2.993, name:"Green Steps", place:"Wrexham", url:SITE_URL },
      aberystwyth:  { lat:52.415, lng:-4.082, name:"Sea Breeze Walk", place:"Aberystwyth", url:SITE_URL },

      // Scotland
      edinburgh:    { lat:55.953, lng:-3.188, name:"Highland Strides", place:"Edinburgh", url:SITE_URL },
      glasgow:      { lat:55.864, lng:-4.251, name:"Clyde Walkers", place:"Glasgow", url:SITE_URL },
      aberdeen_scot:{ lat:57.149, lng:-2.094, name:"Coastal Trekkers", place:"Aberdeen", url:SITE_URL },
      dundee:       { lat:56.462, lng:-2.970, name:"Riverside Steps", place:"Dundee", url:SITE_URL },
      inverness:    { lat:57.477, lng:-4.224, name:"Lochside Strides", place:"Inverness", url:SITE_URL },
      stirling:     { lat:56.116, lng:-3.936, name:"Castle Path Walk", place:"Stirling", url:SITE_URL },

      // Northern Ireland
      belfast:      { lat:54.597, lng:-5.930, name:"Men's Cavehill Walking Club", place:"Belfast, Cavehill", url:"https://www.facebook.com/p/Mens-Cavehill-Walking-Club-100086241889121/?locale=en_GB" },
      derry:        { lat:54.997, lng:-7.309, name:"Riverfront Walkers", place:"Derry / Londonderry", url:SITE_URL },
      lisburn:      { lat:54.514, lng:-6.036, name:"Step Together", place:"Lisburn", url:SITE_URL },
      newry:        { lat:54.175, lng:-6.339, name:"Hill Trekkers", place:"Newry", url:SITE_URL },
      armagh:       { lat:54.350, lng:-6.650, name:"Orchard Strides", place:"Armagh", url:SITE_URL },
      bangor_ni:    { lat:54.660, lng:-5.670, name:"Coastal Breeze Walk", place:"Bangor (NI)", url:SITE_URL },
    };

    // Build markers
    const markersById = {};
    Object.entries(LOCATIONS).forEach(([id, d])=>{
      const m = L.marker([d.lat, d.lng], { icon, keyboard: true }).addTo(map);
      m.bindPopup(makePopup(d.name, d.place), { closeButton: false, autoClose: false });
      // Hover shows; leaving gives a small delay so you can move to the popup
      m.on('mouseover', () => { m.openPopup(); });
      m.on('mouseout',  () => { setTimeout(() => { if(!m.isPopupOpen()) return; /* keep if user entered popup */ }, 200); });
      // Clicking the marker goes to the website in a new tab
      m.on('click', () => { window.open(d.url, '_blank', 'noopener'); });
      markersById[id] = m;
    });

    /* Keep popup from vanishing while interacting with it */
    map.on('popupopen', (e)=>{
      const popupEl = e.popup.getElement();
      if(!popupEl) return;
      popupEl.addEventListener('mouseenter', () => {/* keep open */});
      popupEl.addEventListener('mouseleave', () => { e.popup._source.closePopup(); });
    });

    /* --------------------------------
       3) Sidebar interactions & search
    ----------------------------------*/
    // Expand/collapse
    document.querySelectorAll('.region-toggle').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        const list = document.getElementById(btn.getAttribute('aria-controls'));
        if(list) list.style.display = expanded ? 'none' : 'block';
      });
      btn.addEventListener('keydown', (e)=>{
        if(e.key === 'ArrowDown'){
          const list = document.getElementById(btn.getAttribute('aria-controls'));
          const first = list?.querySelector('.walk-btn'); if(first){ first.focus(); e.preventDefault(); }
        }
      });
    });

    function flyTo(id){
      const m = markersById[id];
      if(!m) return;
      map.flyTo(m.getLatLng(), Math.max(map.getZoom(), 7.5), { duration: 0.6 });
      setTimeout(()=> m.openPopup(), 620);
    }

    document.querySelectorAll('.walk-btn').forEach(btn=>{
      const id = btn.dataset.id;
      btn.addEventListener('click', ()=> flyTo(id));
      btn.addEventListener('mouseenter', ()=> markersById[id]?.openPopup());
      btn.addEventListener('mouseleave', ()=> markersById[id]?.closePopup());
    });

    // Simple search that shows matching items and auto-expands sections
    const searchEl = document.getElementById('walkSearch');
    const lists = Array.from(document.querySelectorAll('.walk-list'));
    const toggles = Array.from(document.querySelectorAll('.region-toggle'));
    let saved=null, scheduled=false, qPending='';

    searchEl.addEventListener('input', ()=>{
      qPending = (searchEl.value||'').trim().toLowerCase();
      if(scheduled) return;
      scheduled = true;
      requestAnimationFrame(applySearch);
    });

    function applySearch(){
      scheduled=false;
      const q = qPending;
      const searching = q.length>0;

      if(searching && !saved){
        saved = {
          displays: lists.map(ul => ul.style.display || ''),
          expanded: toggles.map(b => b.getAttribute('aria-expanded'))
        };
      }

      if(!searching){
        lists.forEach(ul => ul.querySelectorAll('.walk-item').forEach(li => li.style.display=''));
        if(saved){
          lists.forEach((ul,i)=> ul.style.display = saved.displays[i]);
          toggles.forEach((b,i)=> b.setAttribute('aria-expanded', saved.expanded[i]));
          saved=null;
        }
        return;
      }

      lists.forEach((ul,i)=>{
        let matches = 0;
        ul.querySelectorAll('.walk-item').forEach(li=>{
          const ok = (li.textContent||'').toLowerCase().includes(q);
          li.style.display = ok ? '' : 'none';
          if(ok) matches++;
        });
        const btn = toggles[i];
        if(matches > 0){ ul.style.display = 'block'; btn.setAttribute('aria-expanded','true'); }
        else{ ul.style.display = 'none'; }
      });
    }

    /* --------------------------------
       4) Nice-to-haves
    ----------------------------------*/
    // Focus ring for keyboard users on the map
    map.getContainer().addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){
        map.closePopup();
      }
    });
  </script>
</body>
</html>
